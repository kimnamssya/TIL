# Change truecolor image to grayscale image (컬러사진 -> 흑백사진) 

## 1. Bitmap 파일 구조 알기
bitmap file은 다음과 같은 구조로 이루어져 있습니다.
![비트맵구조](https://user-images.githubusercontent.com/48755185/103137050-edcede00-4708-11eb-885f-4b267a0bb09f.JPG)
  
실습을 위한 사진 파일은 24비트 트루컬러 이미지이므로, 오른쪽처럼 색상 테이블이 없는 구조를 가집니다.    

***트루컬러 이미지는 색상표현을 위해 24비트(또는 32비트)를 사용하는 이미지입니다. 각각 8비트를 가지는 R, G, B의 조합으로 표현되며 총 2^24개의 색상을 표현할 수 있습니다.***

### 비트맵 파일 헤더(BITMAPFILEHEADER)  
비트맵 파일 헤더는 다음과 같이 **파일에 대한** 정보를 포함합니다.
|멤버| 바이트| 정보|
|---|:----:|---|
|bfType | 2 | 비트맵 파일이 맞는지 확인('BM'을 표현하는 16진수 0x42 0x4D가 저장)|
|bfSize | 4 | 파일의 크기 정보(Byte)|
|bfReserved1 | 2 | 나중을 위해 사용하지 않는 공간(must be zero)| 
|bfReserved2 | 2 | 나중을 위해 사용하지 않는 공간(must be zero)| 
|bfOffBits | 4 | 픽셀 데이터의 시작 위치|

### 비트맵 정보 헤더(BITMAPINFOHEADER)  
비트맵 정보 헤더는 다음과 같이 **이미지에 대한** 정보를 포함합니다.  
|멤버| 바이트| 정보|
|---|:----:|---|
|biSize|4|비트맵 정보 헤더의 크기|
|biWidth|4|비트맵 이미지의 가로 크기|
|biHeight|4|비트맵 이미지의 세로 크기|
|biPlanes|2|사용하는 색상판의 수(must be set to 1)|
|biBitCount|2|픽셀 당 비트 수(8비트 R, G, B로 이루어져 있으므로 24비트)|
|biCompression|4|압축 방식|
|biSizeImage|4|픽셀 데이터의 크기|
|biXPelsPerMeter|4|수평 해상도|
|biYPelsPerMeter|4|수직 해상도|
|biClrUsed|4|색상 테이블의 사이즈|
|biClrImportant|4|색상 인덱스의 수|

### 픽셀 데이터  
픽셀 데이터에는 다음과 같이 R, G, B 값이 저장되어 있습니다.
|멤버| 바이트| 정보|
|---|:----:|---|
|rgbtBlue|1|blue 0~255|
|rgbtGreen|1|green 0~255|
|rgbtRed|1|red 0~255|

## 2.바이너리 편집기로 분석하기
![바이너리](https://user-images.githubusercontent.com/48755185/103153688-ac583480-47d5-11eb-8451-e3036820437a.JPG)  
***Visual Studio -> 파일 -> 열기 -> 파일 -> 파일 선택 -> 열기 옆 화살표 -> 바이너리 편집기***

실습 이미지를 바이너리 편집기로 열면 위와 같은 화면이 나타납니다.    

***인텔 계열의 CPU는 little endian 방식으로 데이터를 메모리에 올립니다. 이는 메모리의 낮은 주소에 데이터의 하위 바이트를 저장하는 방식입니다. 따라서 올바르게 정보를 읽기 위해서는 데이터의 바이너리 값이 역순으로 저장되어 있어야, 데이터를 메모리에 올려 정보를 읽을 때 올바른 값이 나오게 됩니다.***

* 42 4D &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=> 10진수 변환 시 아스키 코드로 'B'와 'M'을 나타냅니다. 이 정보를 통해 Bitmap file임을 인지할 수 있고, 메모리에 올라갈 때는 little endian 방식에 의해 'MB' 순으로 올라가게 됩니다.  
* 36 00 0C 00 => 파일의 크기가 786,486 byte이고 이를 16진수 변환하면 00 0C 00 36 입니다. 역순으로 저장해야하므로 36 00 0C 00이 저장되어 있습니다.
* 00 00 00 00 => Reserve된 공간이고 zero 값으로 세팅되어 있습니다.
* 36 00 00 00 => pixel data의 시작 위치가 비트맵 파일 헤더로부터 54 Byte 떨어져 있다는 의미입니다(10진수 변환하면). 실제로 54 Byte 떨어진 39 16 ~ 부터 pixel data가 시작됩니다. 
* 28 00 00 00 => 비트맵 정보 헤더의 크기가 40 Byte 라는 의미입니다. 
* 00 02 00 00 => 이미지의 가로 크기입니다(픽셀 단위). 역순으로 표현하면 00 00 02 00 이고 이를 10진수 변환하면 512이므로 가로 512 pixel의 이미지 임을 알 수 있습니다.
* 00 02 00 00 => 이미지의 세로 크기입니다(픽셀 단위).
* 01 00 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=> must be set to 1
* 18 00 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=> 10진수 변환 시 24를 의미하고 한 픽셀당 24Bits(8bits x 3)가 사용됨을 알 수 있습니다.
* 00 00 00 00 => 보통 Bmp 파일은 압축을 하지 않기 때문에 0이 저장됩니다.
* 00 00 00 00 => 이미지의 사이즈를 나타내지만, 압축을 하지 않았을 경우 0이 저장됩니다. 
* 12 0B 00 00 => 수평 해상도를 의미합니다.
* 12 0B 00 00 => 수직 해상도를 의미합니다.
* 00 00 00 00 => 색상 테이블이 존재하지 않으므로 0이 저장됩니다. 
* 00 00 00 00 => 마찬가지로 0이 저장됩니다.  


